with liste_generique; use liste_generique;
with Ada.Text_IO; use Ada.Text_IO;
with Participant; use Participant;
	
	package body Partie is
   
   	-- Nom affichable du Joueur1
    Nom_Joueur1 : String;
    -- Nom affichable du Joueur2   
    Nom_Joueur2 : String;
    -- Calcule l'etat suivant en appliquant le coup
    with function Etat_Suivant(E : Etat; C : Coup) return Etat;
    -- Indique si l'etat courant est gagnant pour le joueur J
    with function Est_Gagnant(E : Etat; J : Joueur) return Boolean; 
    -- Indique si l'etat courant est un status quo (match nul)
    with function Est_Nul(E : Etat) return Boolean; 
    -- Fonction d'affichage de l'etat courant du jeu
    with procedure Affiche_Jeu(E : Etat);
    -- Affiche a l'ecran le coup passe en parametre
    with procedure Affiche_Coup(C : in Coup);   
    -- Retourne le prochaine coup joue par le joueur1
    with function Coup_Joueur1(E : Etat) return Coup;
    -- Retourne le prochaine coup joue par le joueur2   
    with function Coup_Joueur2(E : Etat) return Coup;   


   -- Joue une partie. 
    -- E : Etat initial
    -- J : Joueur qui commence
    procedure Joue_Partie(E : in out Etat; J : in Joueur) is
	
	Coup1, Coup2 : Coup;
	JBis : Joueur;
	
	begin
	Initialiser(E); --On initialise la table de jeu.	
	--Put_line("Choisissez la colonne dans laquelle vous voulez jouer");
	--loop Get(C.numColumn); -- Le placement va definir le coup joue
		--exit when (C < boardGameWidth - 1 or else C > 1);
	--end loop;
	if (J=Joueur1) then
		Coup1 := Coup_Joueur1(E); --Le joueur 1 joue en premier
		Affiche_Coup(Coup1); --Affiche le coup du Joueur 1
		E := Etat_Suivant(E,Coup1); -- On determine le nouvel etat avec le coup joue
	
	else	Coup2 := Coup_Joueur2(E);
		Affiche_Coup(Coup2);
		E := Etat_Suivant(E,Coup2);
	end if; 
	
	Affiche_Jeu(E); --On affiche le nouveau quadrillage du jeu

	
	if Est_Gagnant(E,J) then
	
		Put("Le joueur ");
		if (J=Joueur1) then
			Put("1"); else Put("2");
		end if;
			Put("a gagn√©!");
	end if;
	
	if Est_Nul(E) then
		Put("Match Nul!");
	end if;
	
	if (J=Joueur1) then JBis := Joueur2;
	else JBis := Joueur1;
	end if;
	
	Joue_Partie(E, JBis);

    end Joue_Partie;
end Partie;
